# Docker å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨ï¼ˆå«æ•°æ®æŒä¹…åŒ–ï¼‰

> æœ¬æ–‡æ•´ç†äº†**æœ€å¸¸ç”¨ã€æœ€å®ç”¨ã€é¢å‘æ–°æ‰‹å‹å¥½**çš„ Docker å‘½ä»¤ï¼Œ
> å¹¶**é‡ç‚¹è¡¥å……äº†"æ–‡ä»¶æ˜ å°„ & æ•°æ®ä¿å­˜ï¼ˆVolumeï¼‰"**ç›¸å…³ç”¨æ³•ï¼Œ
> æ—¢å¯å½“å­¦ä¹ ç¬”è®°ï¼Œä¹Ÿå¯å½“æ—¥å¸¸å¼€å‘é€ŸæŸ¥æ‰‹å†Œã€‚

------------------------------------------------------------------------

## ğŸ“¦ ä¸€ã€æ ¸å¿ƒæ¦‚å¿µé€Ÿè§ˆ

  -----------------------------------------------------------------------
  æ¦‚å¿µ                                è¯´æ˜
  ----------------------------------- -----------------------------------
  **Imageï¼ˆé•œåƒï¼‰**                   ç±»ä¼¼"å®‰è£…åŒ…"ï¼Œé€šè¿‡ `docker build`
                                      æˆ– `docker pull` è·å¾—

  **Containerï¼ˆå®¹å™¨ï¼‰**               é•œåƒè¿è¡Œèµ·æ¥çš„å®ä¾‹

  **Volumeï¼ˆæ•°æ®å·ï¼‰**                Docker ç®¡ç†çš„æŒä¹…åŒ–å­˜å‚¨

  **Bind Mountï¼ˆç›®å½•æ˜ å°„ï¼‰**          æœ¬æœºç›®å½•ç›´æ¥æ˜ å°„åˆ°å®¹å™¨

  **Docker Hub**                      å…¬å…±é•œåƒä»“åº“ï¼ˆç±»ä¼¼ GitHubï¼‰
  -----------------------------------------------------------------------

------------------------------------------------------------------------

## ğŸ³ äºŒã€Docker åŸºç¡€å‘½ä»¤

``` bash
# æŸ¥çœ‹ Docker ç‰ˆæœ¬
docker version

# æŸ¥çœ‹ Docker ä¿¡æ¯
docker info
```

------------------------------------------------------------------------

## ğŸ–¼ï¸ ä¸‰ã€é•œåƒï¼ˆImageï¼‰ç›¸å…³å‘½ä»¤

### æŸ¥çœ‹æœ¬åœ°é•œåƒ

``` bash
docker images
```

### ä»è¿œç¨‹ä»“åº“æ‹‰å–é•œåƒ

``` bash
docker pull nginx
docker pull node:18
docker pull mysql:8.0
```

### æ„å»ºé•œåƒ

``` bash
docker build -t my-app:1.0 .
```

### åˆ é™¤æœ¬åœ°é•œåƒ

``` bash
docker rmi my-app:1.0
```

### å¯¼å‡ºé•œåƒä¸ºæ–‡ä»¶

``` bash
docker save -o my-app.tar my-app:1.0
```

### ä»æ–‡ä»¶å¯¼å…¥é•œåƒ

``` bash
docker load -i my-app.tar
```

------------------------------------------------------------------------

## ğŸš€ å››ã€å®¹å™¨ï¼ˆContainerï¼‰ç›¸å…³å‘½ä»¤

### è¿è¡Œå®¹å™¨ï¼ˆåŸºç¡€ï¼‰

``` bash
docker run -d -p 3000:3000 my-app:1.0
```

### æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨

``` bash
docker ps
```

### æŸ¥çœ‹æ‰€æœ‰å®¹å™¨

``` bash
docker ps -a
```

### æŸ¥çœ‹å®¹å™¨æ—¥å¿—

``` bash
docker logs <container_id>
```

### è¿›å…¥å®¹å™¨å†…éƒ¨

``` bash
docker exec -it <container_id> /bin/sh
```

### åœæ­¢å®¹å™¨

``` bash
docker stop <container_id>
```

### å¯åŠ¨å·²åœæ­¢çš„å®¹å™¨

``` bash
docker start <container_id>
```

### åˆ é™¤å®¹å™¨

``` bash
docker rm <container_id>
```

------------------------------------------------------------------------

## ğŸ’¾ äº”ã€**æ–‡ä»¶æ˜ å°„ & æ•°æ®ä¿å­˜ï¼ˆé‡ç‚¹ï¼‰**

> **ç»“è®ºï¼šå®¹å™¨åˆ é™¤åï¼Œå†…éƒ¨æ•°æ®é»˜è®¤ä¼šä¸¢å¤±ã€‚**
> è¦æŒä¹…åŒ–æ•°æ®ï¼Œå¿…é¡»ä½¿ç”¨ï¼š**Bind Mountï¼ˆç›®å½•æ˜ å°„ï¼‰** æˆ–
> **Volumeï¼ˆæ•°æ®å·ï¼‰**ã€‚

### âœ… æ–¹å¼ 1ï¼šæœ¬æœºç›®å½•æ˜ å°„ï¼ˆBind Mountï¼Œæ¨èç”¨äºå¼€å‘ï¼‰

``` bash
docker run -d   -p 3000:3000   -v $(pwd)/data:/app/data   my-app:1.0
```

å«ä¹‰ï¼š\
- å·¦ä¾§ `$(pwd)/data`ï¼šä½ ç”µè„‘ä¸Šçš„æ–‡ä»¶å¤¹\
- å³ä¾§ `/app/data`ï¼šå®¹å™¨å†…è·¯å¾„\
- å®¹å™¨åœ¨ `/app/data` å†™å…¥çš„æ–‡ä»¶ï¼Œä¼š**å®æ—¶ä¿å­˜åœ¨æœ¬æœº `data/` ç›®å½•**ã€‚

**ç¤ºä¾‹ï¼ˆNodeï¼‰**ï¼š

``` js
const fs = require("fs");
fs.writeFileSync("./data/test.txt", "hello docker volume");
```

æ–‡ä»¶ä¼šå‡ºç°åœ¨ï¼š

    ./data/test.txt

------------------------------------------------------------------------

### âœ… æ–¹å¼ 2ï¼šDocker æ•°æ®å·ï¼ˆVolumeï¼Œæ¨èç”¨äºç”Ÿäº§ï¼‰

**åˆ›å»ºæ•°æ®å·ï¼š**

``` bash
docker volume create my-data
```

**æŸ¥çœ‹æ•°æ®å·ï¼š**

``` bash
docker volume ls
```

**ä½¿ç”¨æ•°æ®å·è¿è¡Œå®¹å™¨ï¼š**

``` bash
docker run -d   -p 3000:3000   -v my-data:/app/data   my-app:1.0
```

**æŸ¥çœ‹æ•°æ®å·è¯¦æƒ…ï¼š**

``` bash
docker volume inspect my-data
```

------------------------------------------------------------------------

### âœ… å¸¸è§åœºæ™¯ï¼šMySQL æ•°æ®æŒä¹…åŒ–ï¼ˆå¿…ä¼šï¼‰

``` bash
docker run -d   -p 3306:3306   -e MYSQL_ROOT_PASSWORD=123456   -v mysql-data:/var/lib/mysql   mysql:8.0
```

å³ä½¿åˆ é™¤å®¹å™¨ï¼š

``` bash
docker rm <container_id>
```

æ•°æ®ä»ä¿å­˜åœ¨ `mysql-data` æ•°æ®å·ä¸­ã€‚

------------------------------------------------------------------------

### âœ… å¸¸ç”¨ Volume ç®¡ç†å‘½ä»¤

``` bash
# æŸ¥çœ‹æ‰€æœ‰æ•°æ®å·
docker volume ls

# åˆ›å»ºæ•°æ®å·
docker volume create my-data

# æŸ¥çœ‹æ•°æ®å·è¯¦æƒ…
docker volume inspect my-data

# åˆ é™¤æ•°æ®å·
docker volume rm my-data

# æ¸…ç†æœªä½¿ç”¨çš„æ•°æ®å·ï¼ˆè°¨æ…ï¼‰
docker volume prune
```

------------------------------------------------------------------------

## ğŸ” å…­ã€é•œåƒä»“åº“ï¼ˆDocker Hubï¼‰ç›¸å…³å‘½ä»¤

``` bash
docker login
docker tag my-app:1.0 yourname/my-app:1.0
docker push yourname/my-app:1.0
docker pull yourname/my-app:1.0
```

------------------------------------------------------------------------

## ğŸ§¹ ä¸ƒã€æ¸…ç†ç›¸å…³å‘½ä»¤ï¼ˆé‡Šæ”¾ç£ç›˜ï¼‰

``` bash
docker container prune
docker image prune
docker system prune -a
```

> âš ï¸ `docker system prune -a`
> ä¼šåˆ é™¤æœªä½¿ç”¨çš„å®¹å™¨ã€é•œåƒã€ç½‘ç»œå’Œç¼“å­˜ï¼Œ**æ…ç”¨**ã€‚

------------------------------------------------------------------------

## ğŸ“ å…«ã€Dockerfile å¸¸ç”¨æŒ‡ä»¤é€Ÿè§ˆ

  æŒ‡ä»¤        ä½œç”¨
  ----------- --------------------
  `FROM`      æŒ‡å®šåŸºç¡€é•œåƒ
  `WORKDIR`   è®¾ç½®å·¥ä½œç›®å½•
  `COPY`      å¤åˆ¶æ–‡ä»¶åˆ°å®¹å™¨
  `RUN`       æ„å»ºé•œåƒæ—¶æ‰§è¡Œå‘½ä»¤
  `EXPOSE`    å£°æ˜ç«¯å£
  `CMD`       å®¹å™¨å¯åŠ¨å‘½ä»¤
  `ENV`       è®¾ç½®ç¯å¢ƒå˜é‡

------------------------------------------------------------------------

## ğŸ¯ ä¹ã€å¼€å‘å¿…èƒŒ 5 æ¡å‘½ä»¤

``` bash
docker build -t my-app:1.0 .
docker run -d -p 3000:3000 my-app:1.0
docker ps
docker logs <container_id>
docker stop <container_id>
```


## ğŸ¯ åã€âœ… Dockerfile æ•™å­¦ç‰ˆï¼ˆé€è¡Œå¸¦æ³¨é‡Šï¼‰

``` Dockerfile
# ============================================================
# ã€Dockerfile æ•™å­¦ç‰ˆã€‘
# åœºæ™¯ï¼šNode + Express åç«¯æœåŠ¡
# ç›®æ ‡ï¼šè®©ä½ çœŸæ­£â€œçœ‹æ‡‚ Dockerfile åœ¨å¹²ä»€ä¹ˆâ€
# ============================================================

# ==============================
# â‘  åŸºç¡€é•œåƒï¼ˆBase Imageï¼‰
# ==============================

# FROM = ä½ ç«™åœ¨è°çš„è‚©è†€ä¸Š
# node:18-alpine ä»£è¡¨ï¼š
# - Node.js 18
# - åŸºäº Alpine Linuxï¼ˆä½“ç§¯å°ã€é€‚åˆç”Ÿäº§ï¼‰
FROM node:18-alpine

# ==============================
# â‘¡ è®¾ç½®å·¥ä½œç›®å½•
# ==============================

# WORKDIR = å®¹å™¨é‡Œçš„â€œå·¥ä½œç›®å½•â€
# ç±»ä¼¼äºï¼šcd /app
# ä¹‹åæ‰€æœ‰å‘½ä»¤ï¼ˆCOPYã€RUNã€CMDï¼‰é»˜è®¤åœ¨è¿™ä¸ªç›®å½•æ‰§è¡Œ
WORKDIR /app

# ==============================
# â‘¢ å…ˆæ‹·è´ package æ–‡ä»¶ï¼ˆä¼˜åŒ–æ„å»ºç¼“å­˜ï¼‰
# ==============================

# ä¸ºä»€ä¹ˆè¦å…ˆæ‹·è´ package.jsonï¼Ÿ
# ğŸ‘‰ å¦‚æœä½ çš„ä¸šåŠ¡ä»£ç å˜äº†ï¼Œä½†ä¾èµ–æ²¡å˜ï¼Œ
#    Docker å°±å¯ä»¥â€œå¤ç”¨ç¼“å­˜â€ï¼Œæ„å»ºæ›´å¿«

COPY package.json package-lock.json ./

# ==============================
# â‘£ å®‰è£…ä¾èµ–
# ==============================

# RUN = åœ¨é•œåƒæ„å»ºé˜¶æ®µæ‰§è¡Œçš„å‘½ä»¤
# è¿™é‡Œç›¸å½“äºåœ¨å®¹å™¨é‡Œæ‰§è¡Œï¼š
# npm install
RUN npm install

# ï¼ˆå¯é€‰ï¼šå¦‚æœæ˜¯ç”Ÿäº§ç¯å¢ƒæ¨èï¼‰
# RUN npm ci --production

# ==============================
# â‘¤ æ‹·è´é¡¹ç›®ä»£ç 
# ==============================

# COPY <å®¿ä¸»æœºè·¯å¾„> <å®¹å™¨è·¯å¾„>
# . è¡¨ç¤ºå½“å‰ç›®å½•ï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰
# ä½œç”¨ï¼šæŠŠä½ çš„ä»£ç æ”¾è¿›é•œåƒé‡Œ
COPY . .

# ==============================
# â‘¥ æš´éœ²ç«¯å£ï¼ˆè¯´æ˜æ–‡æ¡£ï¼Œä¸ä¼šè‡ªåŠ¨æ˜ å°„ï¼‰
# ==============================

# EXPOSE åªæ˜¯â€œå£°æ˜â€
# çœŸæ­£æ˜ å°„ç«¯å£è¦é ï¼š
# - docker run -p
# - æˆ– docker compose ports
EXPOSE 3000

# ==============================
# â‘¦ è®¾ç½®å®¹å™¨å¯åŠ¨å‘½ä»¤
# ==============================

# CMD = å®¹å™¨å¯åŠ¨æ—¶é»˜è®¤æ‰§è¡Œçš„å‘½ä»¤
# ä¸‹é¢ç­‰ä»·äºï¼š
# node server.js
CMD ["node", "server.js"]

```